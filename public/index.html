<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#050505">
    
    <title>黑信號控台</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23050505'/%3E%3Cpath d='M18 32h28M32 18v28' stroke='%23ffffff' stroke-width='6' stroke-linecap='round'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="/icon-192.png">

    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="app">
        <nav class="tab-bar">
            <button class="tab-item active" data-tab="home">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>首頁</span>
            </button>
            <button class="tab-item" data-tab="history">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <span>紀錄</span>
            </button>
            <button class="tab-item" data-tab="send">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
                <span>指令</span>
                <span class="tab-hint">桌面限定</span>
            </button>
        </nav>

        <main class="tab-content">
            <section class="tab-pane active" id="homePane">
                <div class="pane-grid">
                    <div class="primary-column">
                        <header class="hero">
                            <span class="eyebrow">系統 // 狀態</span>
                            <h1>信號中樞</h1>
                            <p class="hero-subtitle">內部通訊節點，僅供授權人員使用，維持節奏與安全。</p>
                            <div class="hero-actions">
                                <div class="status-badge" id="statusBadge">
                                    <span class="status-dot"></span>
                                    <span id="statusText">檢查中...</span>
                                </div>
                                <button id="subscribeBtn" class="btn btn-primary" disabled>
                                    啟動系統
                                </button>
                                <div class="auth-controls">
                                    <button id="authBtn" class="btn btn-secondary">
                                        登入系統
                                    </button>
                                    <span id="authBadge" class="auth-badge" hidden></span>
                                    <span id="authDebug" class="auth-debug" hidden></span>
                                </div>
                            </div>
                            <div class="channel-control">
                                <label for="userChannelSelect">訂閱頻道（Channel）</label>
                                <div class="select-wrapper">
                                    <select id="userChannelSelect">
                                        <option value="global">GLOBAL // 全域</option>
                                    </select>
                                    <span class="select-caret" aria-hidden="true"></span>
                                </div>
                                <p class="field-hint" id="channelSelectHint">登入後可加入專屬頻道，未登入僅能接收 global。</p>
                            </div>
                            <div class="channel-control identity-block">
                                <label>當前身分</label>
                                <p id="userIdentityDisplay" class="identity-display">未登入｜訪客裝置</p>
                                <p class="field-hint">登入後會綁定使用者 ID，並可接收針對個人推播。</p>
                            </div>
                            <div class="channel-control join-channel">
                                <label>加入頻道</label>
                                <div class="join-channel-grid">
                                    <input type="text" id="joinChannelInput" placeholder="頻道名稱" autocomplete="off">
                                    <input type="password" id="joinPasscodeInput" placeholder="六位數密碼" maxlength="6" inputmode="numeric" pattern="[0-9]*" autocomplete="off">
                                    <button type="button" class="btn btn-secondary" id="joinChannelBtn">加入</button>
                                </div>
                                <p class="field-hint" id="joinChannelHint">登入後輸入頻道名稱與 6 位密碼即可加入。</p>
                                <div class="join-status" id="joinChannelStatus" hidden></div>
                            </div>
                        </header>

                        <div class="stats-card card">
                            <div class="stat-item">
                                <span class="stat-label">累積訊號</span>
                                <span class="stat-value" id="statTotal">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">24 小時活動</span>
                                <span class="stat-value" id="statToday">-</span>
                            </div>
                        </div>

                        <div class="card recent-section">
                            <div class="panel-head">
                                <div>
                                    <span class="eyebrow">訊號流</span>
                                    <h3>最新訊息</h3>
                                </div>
                            </div>
                            <div id="recentList" class="notification-list">
                                <div class="empty-state">
                                    <p>暫無資料</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <aside class="secondary-column">
                        <div class="card subscription-card">
                            <div class="card-body">
                                <span class="eyebrow">提示</span>
                                <p class="card-desc" style="margin-top:0.5rem">已啟用加密推播通道，請維持最低限度對外暴露。</p>
                            </div>
                        </div>
                    </aside>
                </div>
            </section>

            <section class="tab-pane" id="historyPane">
                <div class="pane-grid single">
                    <div class="card">
                        <div class="panel-head between">
                            <div>
                                <span class="eyebrow">封存</span>
                                <h3>推播紀錄</h3>
                            </div>
                        </div>
                        <div id="notificationList" class="notification-list full-list">
                            <div class="empty-state">
                                <p>暫無紀錄</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="tab-pane" id="sendPane">
                <div class="pane-grid single">
                    <div class="card send-panel">
                        <div class="panel-head">
                            <div>
                                <span class="eyebrow">控台</span>
                                <h3>廣播中心</h3>
                            </div>
                        </div>
                        <div class="panel-lock" id="sendLockOverlay" hidden>
                            <p id="sendLockMessage">請登入後使用廣播功能。</p>
                        </div>
                        
                        <form id="sendForm" class="send-form">
                            <div class="form-group secure-input">
                                <label for="apiKeyInput">授權金鑰</label>
                                <div class="secure-field">
                                    <input type="password" id="apiKeyInput" placeholder="••••••••" autocomplete="off">
                                    <button type="button" class="btn-icon toggle-password" id="toggleApiKey">
                                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="channelSelect">指定頻道（Channel）</label>
                                <div class="select-wrapper">
                                    <select id="channelSelect">
                                        <option value="">全部頻道（預設）</option>
                                        <option value="global">GLOBAL // 全域</option>
                                        <option value="ops">OPS // 指揮線</option>
                                        <option value="alpha">ALPHA // 測試艙</option>
                                        <option value="__custom">自訂頻道</option>
                                    </select>
                                    <span class="select-caret" aria-hidden="true"></span>
                                </div>
                                <div class="custom-channel" id="channelCustomWrap">
                                    <input type="text" id="channelCustomInput" placeholder="輸入頻道名稱">
                                </div>
                                <span class="field-hint">留空即向所有頻道廣播，自訂頻道需與訂閱端一致。</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="recipientTargetInput">指定對象 ID（選填）</label>
                                <input type="text" id="recipientTargetInput" placeholder="例如：device-42">
                                <span class="field-hint">若填寫，訊息僅會送達該 ID 對應的訂閱者。</span>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="titleInput">訊息標題 <span class="required">*</span></label>
                                    <input type="text" id="titleInput" placeholder="請輸入標題" required maxlength="100">
                                    <span class="char-count"><span id="titleCount">0</span>/100</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="bodyInput">訊息內容 <span class="required">*</span></label>
                                    <textarea id="bodyInput" placeholder="請輸入內容" required rows="3" maxlength="500"></textarea>
                                    <span class="char-count"><span id="bodyCount">0</span>/500</span>
                                </div>
                                
                                <div class="form-group full">
                                    <label for="detailInput">額外資料 <span class="optional">(選填)</span></label>
                                    <textarea id="detailInput" placeholder="JSON / 詳細內容" rows="5" maxlength="2000"></textarea>
                                    <span class="char-count"><span id="detailCount">0</span>/2000</span>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-send" id="sendBtn">
                                執行廣播
                            </button>
                        </form>
                        
                        <div id="sendResult" class="send-result" style="display: none;"></div>
                    </div>
                </div>
            </section>
        </main>

        <div class="detail-modal" id="detailModal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <button class="btn-back" id="closeDetailBtn">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        返回
                    </button>
                </div>
                <div class="modal-body">
                    <div class="detail-header">
                        <h2 id="detailTitle"></h2>
                        <div class="detail-meta">
                            <span class="pill channel-pill" id="detailChannel" hidden></span>
                            <span class="pill recipient-pill" id="detailRecipient" hidden></span>
                            <time id="detailTime"></time>
                        </div>
                    </div>
                    <p class="detail-body" id="detailBody"></p>
                    <div class="detail-content" id="detailContent"></div>
                </div>
            </div>
        </div>
    </div>
    <datalist id="channelPreset">
        <option value="global"></option>
        <option value="ops"></option>
        <option value="alpha"></option>
    </datalist>
    <script src="/app.js"></script>
</body>
</html>